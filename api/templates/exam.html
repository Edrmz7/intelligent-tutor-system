<!DOCTYPE html>
<html>
  <head>
    {% load static %}
    <meta charset="utf-8" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="flex items-center justify-center h-screen bg-[#252627] text-white">
    <div class="w-full max-w-3xl p-8 bg-[#252627] rounded-[44px] shadow-xl shadow-black/25 border border-black">
      <div class="flex justify-between items-center mb-4">
        <img class="w-6 h-6" src="{% static "svg/arrow.svg" %}" alt="Flecha" id="prev-btn" />
        <div class="text-lg font-medium" id="question-counter"></div>
        <img class="w-6 h-6" src="{% static "svg/close.svg" %}" alt="Cerrar" />
      </div>
      <hr class="border-gray-600 mb-4" />
      <div class="mb-4 text-center">
        <div class="text-xl font-bold" id="question-text"></div>
      </div>
      <div class="space-y-4" id="answers-container"></div>
      <hr class="border-gray-600 mt-4 mb-4" />
      <div class="flex justify-between">
        <button id="skip-btn" class="px-6 py-3 border border-gray-400 rounded-lg text-white hover:bg-gray-700">Omitir</button>
        <button id="next-btn" class="px-6 py-3 bg-[#7a44d7] rounded-lg text-white hover:bg-purple-700 border-b-4 border-black shadow-md">Siguiente</button>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const questions = [
          {
            question: "¿Qué es un algoritmo y por qué es importante en la programación?",
            answers: ["Conjunto de reglas lógicas", "Código de computadora", "Lenguaje de programación", "Método de depuración"],
            correctAnswer: "Conjunto de reglas lógicas"
          },
          {
            question: "¿Cuál es la diferencia entre un lenguaje compilado e interpretado?",
            answers: ["Compilado es más rápido", "Interpretado necesita un compilador", "Ambos son lo mismo", "No hay diferencia"],
            correctAnswer: "Compilado es más rápido"
          },
          {
            question: "Explica qué es un diagrama de flujo y su utilidad en la programación.",
            answers: ["Representación gráfica de un algoritmo", "Código fuente", "Un lenguaje de programación", "Una base de datos"],
            correctAnswer: "Representación gráfica de un algoritmo"
          },
          {
            question: "¿Qué son las estructuras de control y cuáles son las más comunes?",
            answers: ["Instrucciones que controlan el flujo", "Un lenguaje de programación", "Un tipo de algoritmo", "Una base de datos"],
            correctAnswer: "Instrucciones que controlan el flujo"
          },
          {
            question: "¿Cómo funciona una estructura condicional (if-else) en un lenguaje de programación?",
            answers: ["Ejecuta código si se cumple una condición", "Siempre ejecuta todas las instrucciones", "Se usa solo en Python", "No existe en programación"],
            correctAnswer: "Ejecuta código si se cumple una condición"
          },
          {
            question: "¿Qué es un bucle y qué tipos de bucles existen en la programación?",
            answers: ["Estructura que repite código", "Una estructura condicional", "Un lenguaje de programación", "Una base de datos"],
            correctAnswer: "Estructura que repite código"
          },
          {
            question: "Explica el concepto de variable y su importancia en un programa.",
            answers: ["Espacio en memoria para datos", "Código fuente", "Un lenguaje de programación", "Una estructura de control"],
            correctAnswer: "Espacio en memoria para datos"
          },
          {
            question: "¿Qué es la lógica booleana y cómo se aplica en programación?",
            answers: ["Sistema basado en True y False", "Lenguaje de programación", "Base de datos", "Método de depuración"],
            correctAnswer: "Sistema basado en True y False"
          },
          {
            "question": "¿Cómo se utilizan los operadores lógicos (AND, OR, NOT) en estructuras de control en programación?",
            "answers": ["Para evaluar condiciones en sentencias if", "Para realizar operaciones matemáticas", "Para definir variables", "Para almacenar datos en una base de datos"],
            "correctAnswer": "Para evaluar condiciones en sentencias if"
          },
          {
            question: "¿Qué es la recursividad y en qué casos se utiliza?",
            answers: ["Función que se llama a sí misma", "Un tipo de bucle", "Un lenguaje de programación", "Una base de datos"],
            correctAnswer: "Función que se llama a sí misma"
          },
          {
            question: "¿Cuál es la diferencia entre un operador lógico y un operador aritmético en programación?",
            answers: ["Lógicos evalúan expresiones, aritméticos operan números", "No hay diferencia", "Ambos hacen cálculos", "Ambos solo funcionan en Python"],
            correctAnswer: "Lógicos evalúan expresiones, aritméticos operan números"
          }
        ];

        let currentQuestion = 0;
        const totalQuestions = questions.length;
        const questionCounter = document.getElementById("question-counter");
        const questionText = document.getElementById("question-text");
        const answersContainer = document.getElementById("answers-container");
        const userAnswers = [];

        const generateTruthTable = () => {
          const table = document.createElement("table");
          table.classList.add("w-full", "border-collapse", "border", "border-gray-600", "text-center");
          
          const headerRow = document.createElement("tr");
          ["A", "B", "C", "A AND B", "NOT C", "(A AND B) OR (NOT C)"].forEach(text => {
            const th = document.createElement("th");
            th.classList.add("border", "border-gray-600", "p-2");
            th.textContent = text;
            headerRow.appendChild(th);
          });
          table.appendChild(headerRow);

          for (let a of [0, 1]) {
            for (let b of [0, 1]) {
              for (let c of [0, 1]) {
                const row = document.createElement("tr");
                const andResult = a & b;
                const notC = 1 - c;
                const orResult = andResult | notC;

                [a, b, c, andResult, notC, orResult].forEach(value => {
                  const td = document.createElement("td");
                  td.classList.add("border", "border-gray-600", "p-2");
                  td.textContent = value;
                  row.appendChild(td);
                });
                table.appendChild(row);
              }
            }
          }
          answersContainer.innerHTML = "";
          answersContainer.appendChild(table);
        };

        const updateQuestion = () => {
          questionCounter.textContent = `Pregunta ${currentQuestion + 1} de ${totalQuestions}`;
          questionText.textContent = questions[currentQuestion].question;
          answersContainer.innerHTML = "";
          if (questions[currentQuestion].question.includes("tabla de verdad")) {
            generateTruthTable();
          } else {
            questions[currentQuestion].answers.forEach((answer, index) => {
              const label = document.createElement("label");
              label.classList.add("flex", "items-center", "space-x-2", "cursor-pointer");
              label.innerHTML = `
                <div class='w-5 h-5 border-2 border-gray-400 rounded-full flex items-center justify-center'>
                  <div class='w-3 h-3 bg-transparent rounded-full'></div>
                </div>
                <span>${answer}</span>
              `;
              label.addEventListener("click", () => {
                userAnswers[currentQuestion] = {
                  question: questions[currentQuestion].question,
                  selectedAnswer: answer,
                  isCorrect: answer === questions[currentQuestion].correctAnswer,
                };
                updateSelectedAnswer();
              });
              answersContainer.appendChild(label);
            });
          }
          updateSelectedAnswer();
        };

        const updateSelectedAnswer = () => {
          const labels = answersContainer.querySelectorAll("label");
          labels.forEach((label, index) => {
            const circle = label.querySelector("div > div");
            if (
              userAnswers[currentQuestion] &&
              userAnswers[currentQuestion].selectedAnswer === questions[currentQuestion].answers[index]
            ) {
              circle.classList.add("bg-purple-500");
            } else {
              circle.classList.remove("bg-purple-500");
            }
          });
        };

        const showResults = () => {
          const correctAnswers = userAnswers.filter(answer => answer.isCorrect).length;
          const incorrectAnswers = totalQuestions - correctAnswers;
          const percentage = ((correctAnswers / totalQuestions) * 100).toFixed(2);

          const results = `
            <div class="text-center">
              <h2 class="text-2xl font-bold mb-4">Resultados</h2>
              <p>Total de preguntas: ${totalQuestions}</p>
              <p>Respuestas correctas: ${correctAnswers}</p>
              <p>Respuestas incorrectas: ${incorrectAnswers}</p>
              <p>Porcentaje de aciertos: ${percentage}%</p>
            </div>
          `;

          questionText.innerHTML = results;
          answersContainer.innerHTML = "";
          document.getElementById("next-btn").style.display = "none";
          document.getElementById("skip-btn").style.display = "none";
        };

        const saveAnswers = () => {
          const json = JSON.stringify(userAnswers, null, 2);
          const blob = new Blob([json], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "respuestas.json";
          a.click();
          URL.revokeObjectURL(url);
        };

        document.getElementById("next-btn").addEventListener("click", () => {
          if (currentQuestion < totalQuestions - 1) {
            currentQuestion++;
            updateQuestion();
          } else {
            showResults();
            saveAnswers();
          }
        });

        document.getElementById("skip-btn").addEventListener("click", () => {
          if (currentQuestion < totalQuestions - 1) {
            currentQuestion++;
            updateQuestion();
          } else {
            showResults();
            saveAnswers();
          }
        });

        document.getElementById("prev-btn").addEventListener("click", () => {
          if (currentQuestion > 0) {
            currentQuestion--;
            updateQuestion();
          }
        });

        updateQuestion();
      });
    </script>
  </body>
</html>